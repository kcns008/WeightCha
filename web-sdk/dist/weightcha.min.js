!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).WeightCha={})}(this,function(e){"use strict";class WeightCha{constructor(e){if(this.initialized=!1,this.currentChallenge=null,this.config={baseUrl:"https://api.weightcha.com",theme:"auto",language:"en",debug:!1,...e},!this.config.apiKey)throw new Error("API key is required")}async init(){if(!this.initialized)try{await this.checkClientAvailability(),this.loadStyles(),this.initialized=!0,this.log("WeightCha SDK initialized successfully")}catch(e){throw new Error(`Failed to initialize WeightCha: ${e.message}`)}}async verify(e,t={}){this.initialized||await this.init();const n=document.getElementById(e);if(!n)throw new Error(`Container element with id '${e}' not found`);try{const e=await this.createChallenge(t);this.currentChallenge=e,this.renderUI(n,e,t);const i=await this.waitForVerification(e);return i.success&&t.onSuccess&&t.onSuccess(i.token),i}catch(e){return this.log("Verification error:",e),t.onError&&t.onError(e),{success:!1,error:e.message}}finally{this.currentChallenge=null}}async validateToken(e){try{const t=await this.apiCall("/verification/validate-token",{method:"POST",body:JSON.stringify({token:e})});return t.data.valid&&t.data.isHuman}catch(e){return this.log("Token validation error:",e),!1}}async checkClientAvailability(){if(navigator.platform.includes("Mac"))try{if((await fetch("http://localhost:8080/health",{method:"GET",headers:{"Content-Type":"application/json"}})).ok)return void this.log("macOS client detected - using native trackpad integration")}catch(e){this.log("macOS client not available, falling back to touch/mouse events")}this.log("Using browser-based verification for device:",navigator.platform)}async createChallenge(e){const n=await this.apiCall("/challenges",{method:"POST",body:JSON.stringify({type:e.type||"pressure_pattern",difficulty:e.difficulty||"medium",duration:e.duration||5})});return new t(n.data,this.config)}renderUI(e,t,n){e.innerHTML=`\n      <div class="weightcha-container" data-theme="${this.config.theme}">\n        <div class="weightcha-header">\n          <h3>Human Verification</h3>\n          <p>Press and hold to verify you're human</p>\n        </div>\n        \n        <div class="weightcha-status">\n          <div class="weightcha-status-icon">\n            <svg class="weightcha-trackpad-icon" viewBox="0 0 100 100">\n              <rect x="10" y="20" width="80" height="60" rx="8" fill="currentColor" opacity="0.1"/>\n              <rect x="15" y="25" width="70" height="50" rx="4" fill="currentColor" opacity="0.2"/>\n            </svg>\n          </div>\n          <div class="weightcha-status-text">\n            <div class="weightcha-instructions">${t.instructions}</div>\n            <div class="weightcha-progress">\n              <div class="weightcha-progress-bar">\n                <div class="weightcha-progress-fill" style="width: 0%"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="weightcha-actions">\n          <button class="weightcha-btn weightcha-btn-primary" id="weightcha-start">\n            Start Verification\n          </button>\n          <button class="weightcha-btn weightcha-btn-secondary" id="weightcha-cancel" style="display: none;">\n            Cancel\n          </button>\n        </div>\n        \n        <div class="weightcha-footer">\n          <a href="https://weightcha.com" target="_blank">Powered by WeightCha</a>\n        </div>\n      </div>\n    `,this.bindEvents(e,t,n)}bindEvents(e,t,n){const i=e.querySelector("#weightcha-start"),a=e.querySelector("#weightcha-cancel");i.addEventListener("click",async()=>{try{await t.start(),i.style.display="none",a.style.display="inline-block"}catch(e){this.log("Failed to start challenge:",e),n.onError&&n.onError(e)}}),a.addEventListener("click",()=>{t.cancel(),n.onCancel&&n.onCancel()})}async waitForVerification(e){return new Promise((t,n)=>{e.onComplete=e=>{t({success:!0,token:e.token,isHuman:e.isHuman,confidence:e.confidence})},e.onError=e=>{n(e)},e.onCancel=()=>{t({success:!1,error:"Verification cancelled by user"})}})}async apiCall(e,t={}){const n=`${this.config.baseUrl}/api/v1${e}`,i=await fetch(n,{...t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,...t.headers}});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||`HTTP ${i.status}: ${i.statusText}`)}return i.json()}loadStyles(){if(document.getElementById("weightcha-styles"))return;const e=document.createElement("style");e.id="weightcha-styles",e.textContent=this.getCSSStyles(),document.head.appendChild(e)}getCSSStyles(){return'\n      .weightcha-container {\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        border: 1px solid #e0e0e0;\n        border-radius: 8px;\n        padding: 24px;\n        max-width: 400px;\n        margin: 0 auto;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n\n      .weightcha-container[data-theme="dark"] {\n        background: #1a1a1a;\n        border-color: #333;\n        color: #ffffff;\n      }\n\n      .weightcha-header {\n        text-align: center;\n        margin-bottom: 20px;\n      }\n\n      .weightcha-header h3 {\n        margin: 0 0 8px 0;\n        font-size: 18px;\n        font-weight: 600;\n      }\n\n      .weightcha-header p {\n        margin: 0;\n        font-size: 14px;\n        color: #666;\n      }\n\n      .weightcha-container[data-theme="dark"] .weightcha-header p {\n        color: #999;\n      }\n\n      .weightcha-status {\n        display: flex;\n        align-items: center;\n        margin-bottom: 24px;\n        padding: 16px;\n        background: #f8f9fa;\n        border-radius: 6px;\n      }\n\n      .weightcha-container[data-theme="dark"] .weightcha-status {\n        background: #2a2a2a;\n      }\n\n      .weightcha-status-icon {\n        margin-right: 16px;\n      }\n\n      .weightcha-trackpad-icon {\n        width: 48px;\n        height: 48px;\n        color: #007AFF;\n      }\n\n      .weightcha-instructions {\n        font-size: 14px;\n        margin-bottom: 12px;\n        font-weight: 500;\n      }\n\n      .weightcha-progress {\n        width: 100%;\n      }\n\n      .weightcha-progress-bar {\n        width: 100%;\n        height: 4px;\n        background: #e0e0e0;\n        border-radius: 2px;\n        overflow: hidden;\n      }\n\n      .weightcha-progress-fill {\n        height: 100%;\n        background: linear-gradient(90deg, #007AFF, #00C7FF);\n        border-radius: 2px;\n        transition: width 0.3s ease;\n      }\n\n      .weightcha-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: center;\n        margin-bottom: 16px;\n      }\n\n      .weightcha-btn {\n        padding: 10px 20px;\n        border: none;\n        border-radius: 6px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      }\n\n      .weightcha-btn-primary {\n        background: #007AFF;\n        color: white;\n      }\n\n      .weightcha-btn-primary:hover {\n        background: #0056CC;\n      }\n\n      .weightcha-btn-secondary {\n        background: #f0f0f0;\n        color: #333;\n      }\n\n      .weightcha-btn-secondary:hover {\n        background: #e0e0e0;\n      }\n\n      .weightcha-footer {\n        text-align: center;\n      }\n\n      .weightcha-footer a {\n        font-size: 12px;\n        color: #999;\n        text-decoration: none;\n      }\n\n      .weightcha-footer a:hover {\n        color: #007AFF;\n      }\n    '}log(...e){this.config.debug}}class t{constructor(e,t){this.data=e,this.config=t}get id(){return this.data.challengeId}get instructions(){return this.data.instructions}async start(){if(navigator.platform.includes("Mac"))try{return void await this.startMacOSChallenge()}catch(e){}this.startBrowserChallenge()}async startMacOSChallenge(){const e=new WebSocket(`ws://localhost:8080/challenge/${this.id}`);e.onopen=()=>{e.send(JSON.stringify({action:"start_challenge",challengeId:this.id,config:this.data}))},e.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"challenge_complete":this.onComplete&&this.onComplete(t.result);break;case"challenge_error":this.onError&&this.onError(new Error(t.error));break;case"progress_update":this.updateProgress(t.progress)}},e.onerror=()=>{throw new Error("Failed to connect to WeightCha client")}}startBrowserChallenge(){const e=document.querySelector(".weightcha-status");if(!e)return;let t=!1,n=0,i=[],a=null;const r=e=>{e.preventDefault(),t||(t=!0,n=Date.now(),i=[],this.updateProgress(0),a=window.setInterval(()=>{if(!t)return;const a=Date.now()-n,r=Math.min(a/3e3,1),o=Math.min(1,.3+a/2e3),s=.15*(Math.random()-.5),c=Math.max(.1,Math.min(1,o+s));i.push({pressure:c,timestamp:a,force:e.force||c}),this.updateProgress(r),r>=1&&this.completeBrowserChallenge(i)},50))},o=()=>{t&&(t=!1,a&&(clearInterval(a),a=null),i.length<10&&this.updateProgress(0))};e.addEventListener("mousedown",r),e.addEventListener("mouseup",o),e.addEventListener("mouseleave",o),e.addEventListener("touchstart",r),e.addEventListener("touchend",o),e.style.cursor="pointer",e.style.userSelect="none"}async completeBrowserChallenge(e){try{const t=this.analyzePressurePattern(e);if(t.isHuman&&this.onComplete){const e="browser_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);this.onComplete({token:e,isHuman:t.isHuman,confidence:t.confidence})}else this.onError&&this.onError(new Error("Verification failed - please try again"))}catch(e){this.onError&&this.onError(e)}}analyzePressurePattern(e){if(e.length<5)return{isHuman:!1,confidence:0};const t=e.map(e=>e.pressure),n=t.reduce((e,t)=>e+t)/t.length,i=Math.max(...t),a=i-Math.min(...t)>.05||n>.2,r=e[e.length-1].timestamp>500,o=a&&r&&i>.1;return{isHuman:o,confidence:o?Math.floor(85+10*Math.random()):Math.floor(40*Math.random())}}cancel(){this.onCancel&&this.onCancel()}updateProgress(e){const t=document.querySelector(".weightcha-progress-fill");t&&(t.style.width=100*e+"%")}}"undefined"!=typeof module&&module.exports&&(module.exports={WeightCha:WeightCha}),"undefined"!=typeof window&&(window.WeightCha=WeightCha),e.WeightCha=WeightCha});
//# sourceMappingURL=weightcha.min.js.map
